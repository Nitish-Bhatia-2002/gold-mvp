<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gold Price Today (India) — MVP v3</title>
  <meta name="description"
    content="Live gold price (XAUUSD) with India-friendly calculator for 24k/22k/18k, per gram, per 10g, and per tola. Educational only." />

  <!-- Tailwind quick CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .card {
      box-shadow: 0 8px 24px rgba(0, 0, 0, .06);
    }
  </style>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-P2GZYHXZNB"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-P2GZYHXZNB');
  </script>
</head>

<body class="bg-gray-50 text-gray-900">
  <!-- HEADER -->
  <header class="max-w-5xl mx-auto p-4 md:p-6">
    <h1 class="text-2xl md:text-4xl font-bold">
      Gold Price Today (India) — MVP v3 ✅
    </h1>
    <p class="text-sm md:text-base text-gray-600">
      Live chart + India-style calculator (24k / 22k / 18k). Not investment advice.
    </p>
  </header>

  <!-- SECTION: LIVE CHART -->
  <section class="max-w-5xl mx-auto p-4 md:p-6">
    <div class="bg-white rounded-2xl card">
      <div class="p-4 flex items-center justify-between">
        <h2 class="text-xl font-semibold">Live Gold Chart (XAUUSD)</h2>
        <span class="text-xs text-gray-500">Source: TradingView</span>
      </div>
      <div class="px-3 pb-4">
        <div class="tradingview-widget-container">
          <div id="tvchart" style="height: 420px;"></div>
        </div>
      </div>
    </div>
  </section>

  <!-- SECTION: CALCULATOR -->
  <section class="max-w-5xl mx-auto p-4 md:p-6">
    <div class="bg-white rounded-2xl card p-4 md:p-6">
      <h2 class="text-xl font-semibold mb-2">Quick Price Estimator (INR)</h2>
      <p class="text-sm text-gray-600 mb-4">
        Choose purity, enter weight, and we add making% + GST (3% on gold, 5% on making). This is an estimate like
        Indian jewellers give.
      </p>

      <!-- form -->
      <form id="calc" class="grid md:grid-cols-4 gap-3 mb-4">
        <label class="text-sm">
          Purity
          <select id="purity" class="w-full border rounded px-2 py-2">
            <option value="0.999">24k (999)</option>
            <option value="0.916">22k (916)</option>
            <option value="0.750">18k (750)</option>
          </select>
        </label>

        <label class="text-sm">
          Weight (grams)
          <input id="weight" type="number" value="10" step="0.01" class="w-full border rounded px-2 py-2" />
        </label>

        <label class="text-sm">
          Making % (on gold value)
          <input id="making" type="number" value="8" step="0.1" class="w-full border rounded px-2 py-2" />
        </label>

        <div class="flex items-end">
          <button id="recalc" class="w-full bg-black text-white rounded-lg py-2">
            Recalculate
          </button>
        </div>
      </form>

      <div id="liveMeta" class="text-xs text-gray-500 mb-3">
        Right now this uses a sample price (2400 USD/oz, USDINR=85). Later we will connect a live API.
      </div>

      <!-- output cards -->
      <div class="grid md:grid-cols-3 gap-3">
        <div class="border rounded-xl p-3">
          <div class="text-xs text-gray-500">Per gram</div>
          <div id="perGram" class="text-2xl font-bold">–</div>
        </div>
        <div class="border rounded-xl p-3">
          <div class="text-xs text-gray-500">Per 10 grams</div>
          <div id="per10g" class="text-2xl font-bold">–</div>
        </div>
        <div class="border rounded-xl p-3">
          <div class="text-xs text-gray-500">Per tola (11.6638 g)</div>
          <div id="perTola" class="text-2xl font-bold">–</div>
        </div>
      </div>

      <p class="text-xs text-gray-500 mt-4">
        Note: Actual shop price may differ (local premium, offers, design). GST rules: 3% on gold value + 5% on making.
      </p>
    </div>
  </section>

  <!-- SECTION: DAILY GOLD UPDATES (AI DIGEST) -->
  <section class="max-w-5xl mx-auto p-4 md:p-6">
    <div class="bg-white rounded-2xl card p-4 md:p-6">
      <h2 class="text-xl font-semibold mb-2">Daily Gold Updates</h2>
      <p class="text-sm text-gray-600 mb-4">
        Short briefing generated daily based on spot gold, USD/INR, and basic macro trends. Educational only.
      </p>

      <p id="digest-updated" class="text-xs text-gray-500 mb-2">
        Loading today’s briefing…
      </p>
      <div id="digest-html" class="text-sm leading-relaxed"></div>

      <p id="digest-meta" class="text-xs text-gray-400 mt-3">
        Content generated automatically; prices and commentary may be delayed or approximate.
      </p>
    </div>
  </section>

  <!-- SECTION: FREE WIDGET (FALLBACK) -->
  <section class="max-w-5xl mx-auto p-4 md:p-6">
    <div class="bg-white rounded-2xl card p-4 md:p-6">
      <h2 class="text-lg font-semibold mb-2">Alternative Live Widget</h2>
      <p class="text-sm text-gray-600 mb-3">
        If your own API is down, this still shows prices.
      </p>
      <iframe title="Gold widget" loading="lazy" style="width:100%;height:400px;border:0;border-radius:1rem;"
        src="https://goldbroker.com/widget/gold?currency=INR&units=gram&size=large"></iframe>
      <p class="text-xs text-gray-500 mt-2">
        Source: goldbroker.com (public widget).
      </p>
    </div>
  </section>

  <!-- FOOTER -->
  <footer class="max-w-5xl mx-auto p-4 md:p-6 text-xs text-gray-500">
    <p>
      © <span id="yr"></span> Gold MVP. Educational only. Data may be delayed.
    </p>
  </footer>

  <!-- TradingView script -->
  <script src="https://s3.tradingview.com/tv.js"></script>
  <script>
    // render chart
    new TradingView.widget({
      container_id: 'tvchart',
      width: '100%',
      height: 420,
      symbol: 'OANDA:XAUUSD',
      interval: '60',
      timezone: 'Asia/Kolkata',
      theme: 'light',
      style: '1',
      locale: 'en',
      hide_side_toolbar: true,
      allow_symbol_change: false,
      calendar: true,
    });
  </script>

  <!-- calculator logic -->
  <script>
    const CONSTS = {
      TROY_G: 31.1034768,
      TOLA_G: 11.6638038,
    };

    // For now, we pretend spot is 2400 USD/oz and USDINR=85.
    // Later we can replace this with a real API.
    const MOCK_SPOT_USD_OZ = 2400;
    const MOCK_USD_INR = 85;

    function formatINR(value) {
      return '₹' + value.toFixed(0).toLocaleString('en-IN');
    }

    function computeINRPerGram24k(spotUsdOz, usdInr) {
      const inrPerOz = spotUsdOz * usdInr;
      return inrPerOz / CONSTS.TROY_G;
    }

    function recalc() {
      const purity = parseFloat(document.getElementById('purity').value);
      const weight = parseFloat(document.getElementById('weight').value || '0');
      const makingPct = parseFloat(document.getElementById('making').value || '0');

      // Base 24k INR per gram
      const inrPerGram24k = computeINRPerGram24k(
        MOCK_SPOT_USD_OZ,
        MOCK_USD_INR
      );

      // Adjust for purity
      const basePerGram = inrPerGram24k * purity;

      // Making charges on gold value
      const makingPerGram = (basePerGram * makingPct) / 100;

      // GST: 3% on gold value, 5% on making charges
      const gstOnGold = basePerGram * 0.03;
      const gstOnMaking = makingPerGram * 0.05;

      const totalPerGram = basePerGram + makingPerGram + gstOnGold + gstOnMaking;

      const perGramEl = document.getElementById('perGram');
      const per10gEl = document.getElementById('per10g');
      const perTolaEl = document.getElementById('perTola');

      if (perGramEl) perGramEl.textContent = formatINR(totalPerGram);
      if (per10gEl) per10gEl.textContent = formatINR(totalPerGram * 10);
      if (perTolaEl) perTolaEl.textContent = formatINR(totalPerGram * CONSTS.TOLA_G);
    }

    document.getElementById('recalc').addEventListener('click', function (e) {
      e.preventDefault();
      recalc();
    });

    // Initial calculation + year
    document.addEventListener('DOMContentLoaded', function () {
      recalc();
      const yrEl = document.getElementById('yr');
      if (yrEl) yrEl.textContent = new Date().getFullYear();
    });
  </script>

  <!-- Daily AI Gold Digest loader -->
  <script>
    async function loadGoldDigest() {
      try {
        const res = await fetch('/api/gold-digest');
        if (!res.ok) {
          throw new Error('HTTP ' + res.status);
        }

        const data = await res.json();

        const updatedEl = document.getElementById('digest-updated');
        if (updatedEl) {
          updatedEl.textContent = 'Updated: ' + data.date;
        }

        const htmlEl = document.getElementById('digest-html');
        if (htmlEl) {
          htmlEl.innerHTML = data.html;
        }
      } catch (err) {
        console.error('Failed to load gold digest', err);
        const updatedEl = document.getElementById('digest-updated');
        if (updatedEl) {
          updatedEl.textContent =
            'Could not load latest briefing. Please try again later.';
        }
      }
    }

    // Load digest on page load
    document.addEventListener('DOMContentLoaded', loadGoldDigest);
  </script>
</body>

</html>